<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Power of Fasting and Prayer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the message container */
        .message-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            transition: all 0.5s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        .message-container.active {
            opacity: 1;
            bottom: 40px;
            pointer-events: auto;
        }
        
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Firebase Configuration and Initialization ---
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;

        // Function to show a temporary message
        function showMessage(text, isError = false) {
            const messageEl = document.getElementById('message-box');
            messageEl.textContent = text;
            messageEl.className = `message-container active px-6 py-3 rounded-full shadow-lg ${isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}`;
            setTimeout(() => {
                messageEl.classList.remove('active');
            }, 3000);
        }

        // --- Authentication and Firestore Setup ---
        async function setupFirebase() {
            try {
                if (authToken) {
                    await signInWithCustomToken(auth, authToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                document.getElementById('user-id').textContent = `User ID: ${userId}`;
                
                // Set up real-time listener for prayer requests
                const userPrayerRef = collection(db, `artifacts/${appId}/users/${userId}/prayerRequests`);
                const q = query(userPrayerRef, orderBy('timestamp', 'desc'));

                onSnapshot(q, (snapshot) => {
                    const requestsList = document.getElementById('prayer-requests-list');
                    requestsList.innerHTML = '';
                    if (snapshot.empty) {
                        requestsList.innerHTML = '<p class="text-center text-gray-500 mt-4">No prayer requests yet. Send one!</p>';
                        return;
                    }
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const li = document.createElement('li');
                        li.className = 'bg-gray-100 p-4 rounded-lg shadow-sm';
                        const date = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleDateString() : 'N/A';
                        li.innerHTML = `
                            <h4 class="font-bold text-lg mb-1">${data.name}</h4>
                            <p class="text-gray-700 italic">${data.prayer}</p>
                            <p class="text-right text-sm text-gray-500 mt-2">${date}</p>
                        `;
                        requestsList.appendChild(li);
                    });
                });

            } catch (error) {
                console.error("Firebase Auth or Firestore Error:", error);
                showMessage("Failed to connect. Please try again.", true);
            }
        }

        // --- Prayer Request Form Submission ---
        document.getElementById('prayer-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name-input').value;
            const prayer = document.getElementById('prayer-input').value;
            const submitBtn = document.getElementById('submit-btn');
            
            if (!name || !prayer) {
                showMessage("Please fill in both fields.", true);
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';

            try {
                const userPrayerRef = collection(db, `artifacts/${appId}/users/${userId}/prayerRequests`);
                await addDoc(userPrayerRef, {
                    name: name,
                    prayer: prayer,
                    timestamp: new Date()
                });
                showMessage("Prayer request sent successfully!");
                document.getElementById('prayer-form').reset();
            } catch (error) {
                console.error("Error adding prayer request:", error);
                showMessage("Failed to send request. Please try again.", true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Request';
            }
        });

        // Initialize Firebase on page load
        document.addEventListener('DOMContentLoaded', setupFirebase);
    </script>

    <!-- Header Section -->
    <header class="bg-indigo-700 text-white py-8 shadow-lg">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">The Power of Fasting and Prayer</h1>
            <p class="text-lg md:text-xl font-light">Drawing closer to God with a focused heart.</p>
        </div>
    </header>

    

    <!-- Main Content Section -->
    <main class="container mx-auto px-6 py-12">
        <!-- Introduction to Fasting and Prayer -->
        <section id="introduction" class="mb-16">
            <h2 class="text-3xl font-bold text-indigo-800 text-center mb-6">What is Fasting and Prayer?</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg leading-relaxed text-lg">
                <p class="mb-4">
                    Fasting is a spiritual discipline where we abstain from something, typically food, for a specific period to focus more intently on God. It is not about simply going without something, but about replacing that time and energy with prayer, Bible study, and worship. When done with the right heart, fasting allows us to quiet our physical desires and amplify our spiritual connection, making us more receptive to God's voice.
                </p>
                <p>
                    Prayer is our direct line of communication with God. When we combine fasting with prayer, we are making a powerful statement of intentionality. It's a way of telling God that our relationship with Him is more important than our physical needs. This combination strengthens our faith, deepens our humility, and prepares us to seek God's will with greater clarity and purpose.
                </p>
            </div>
        </section>

        <!-- Importance Section -->
        <section id="importance" class="mb-16">
            <h2 class="text-3xl font-bold text-indigo-800 text-center mb-6">Why Fast and Pray?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Card 1: Spiritual Focus -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold text-indigo-700 mb-3">Deeper Spiritual Focus</h3>
                    <p class="text-lg leading-relaxed">
                        Fasting helps us shift our focus from the physical world to the spiritual. By denying our body's demands, we become more aware of our spiritual needs and desires, allowing us to pursue God with greater intensity.
                    </p>
                </div>
                <!-- Card 2: Humility and Dependence -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold text-indigo-700 mb-3">Cultivating Humility</h3>
                    <p class="text-lg leading-relaxed">
                        It's an act of humility, admitting our dependence on God for everything, not just for our physical sustenance. It reminds us that "man shall not live on bread alone, but on every word that comes from the mouth of God" (Matthew 4:4).
                    </p>
                </div>
            </div>
        </section>

        <!-- Encouragement Section -->
        <section id="encouragement" class="mb-16">
            <h2 class="text-3xl font-bold text-indigo-800 text-center mb-6">Encouragement for Your Journey</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg leading-relaxed text-lg">
                <p class="mb-4">
                    Remember that fasting is a personal and private act between you and God. It's not about showing off or earning favor. The most important part is the condition of your heart and the time you spend in prayer. Be encouraged, for God sees your sincerity and rewards your faithfulness. Start small, be flexible, and listen to what your body and spirit are telling you. The goal is to grow closer to Him, not to meet a certain benchmark.
                </p>
                <p>
                    Even a small sacrifice, when offered with a sincere heart, is powerful. Whether you fast from a meal, a type of food, or a distraction like social media, the key is to use that time to seek God's presence.
                </p>
            </div>
        </section>

        <!-- Bible Verses Section -->
        <section id="bible-verses" class="mb-16">
            <h2 class="text-3xl font-bold text-indigo-800 text-center mb-6">Bible Verses on Fasting and Prayer</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <ul class="space-y-6">
                    <li>
                        <blockquote class="italic text-lg">
                            "And when you fast, do not look gloomy like the hypocrites, for they disfigure their faces that their fasting may be seen by others. Truly, I say to you, they have received their reward. But when you fast, anoint your head and wash your face, that your fasting may not be seen by others but by your Father who is in secret. And your Father who sees in secret will reward you."
                        </blockquote>
                        <p class="text-right text-sm font-semibold text-indigo-700 mt-2">— Matthew 6:16-18</p>
                    </li>
                    <li>
                        <blockquote class="italic text-lg">
                            "So we fasted and implored our God for this, and he listened to our entreaty."
                        </blockquote>
                        <p class="text-right text-sm font-semibold text-indigo-700 mt-2">— Ezra 8:23</p>
                    </li>
                    <li>
                        <blockquote class="italic text-lg">
                            "Then I proclaimed a fast there, at the river Ahava, that we might humble ourselves before our God, to seek from him a safe journey for ourselves, our children, and all our goods."
                        </blockquote>
                        <p class="text-right text-sm font-semibold text-indigo-700 mt-2">— Ezra 8:21</p>
                    </li>
                    <li>
                        <blockquote class="italic text-lg">
                            "But this kind never comes out except by prayer and fasting."
                        </blockquote>
                        <p class="text-right text-sm font-semibold text-indigo-700 mt-2">— Matthew 17:21</p>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Prayer Request Section -->
        <section id="prayer-requests">
            <h2 class="text-3xl font-bold text-indigo-800 text-center mb-6">Submit Here Your Prayer Request</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
                <div class="mb-6 text-center text-sm text-gray-500">
                    Your User ID is: <span id="user-id" class="font-mono text-gray-700">Loading...</span>
                </div>
                <!-- Prayer Request Form -->
                <form id="prayer-form" class="space-y-4">
                    <div>
                        <label for="name-input" class="block text-lg font-medium text-gray-700 mb-1">Your Name</label>
                        <input type="text" id="name-input" placeholder="Enter your name" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="prayer-input" class="block text-lg font-medium text-gray-700 mb-1">Prayer Point</label>
                        <textarea id="prayer-input" placeholder="Write your prayer request here..." rows="4" required
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" id="submit-btn"
                                class="bg-indigo-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-600 transition-colors">
                            Send Request
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Submitted Prayer Requests Display -->
            <div class="mt-12 max-w-2xl mx-auto">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">My Submitted Requests</h3>
                <ul id="prayer-requests-list" class="space-y-4">
                    <!-- Prayer requests will be loaded here dynamically -->
                </ul>
            </div>
        </section>
    </main>

    <!-- Global message container -->
    <div id="message-box" class="message-container"></div>
</body>
</html>
